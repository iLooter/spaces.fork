var cookie={get:function(e,o){var n=cookie.all(),t=n[e];return void 0===t?o:t},set:function(e,o,n){n=extend({path:"/",expires:0,secure:!1,domain:"."+base_domain(location.host)},n),!n.expires||n.expires instanceof Date||(n.expires=new Date(+new Date+864e5*n.expires));var t=encodeURIComponent(e)+"="+encodeURIComponent(o);return n.expires&&(t+="; expires="+n.expires.toUTCString()),n.domain&&(t+="; domain="+n.domain),n.path&&(t+="; path="+n.path),n.secure&&(t+="; secure"),document.cookie=t,this},all:function(){var e,o,n,t;if(""==document.cookie)return{};for(e=document.cookie.split(";"),o={},n=0;n<e.length;++n)t=e[n].split("=")," "==t[0].charAt(0)&&(t[0]=t[0].substr(1)),o[decodeURIComponent(t[0])]=void 0!==t[1]?decodeURIComponent(t[1]):"";return o},enabled:function(){var e="ololo_"+Date.now();return cookie.set(e,1).get(e)?(cookie.remove(e),!0):!1},remove:function(e){return cookie.set(e,"",{expires:-1})}};define("sound","init",function(){function e(){var e;if(h&&!t()||!document.cookie.match(/audio_force_flash=1/)||!t()){try{e=window.Audio?new Audio:ce("audio")}catch(n){e=window.Audio?new Audio(null):ce("audio")}e&&e.canPlayType&&e.canPlayType("audio/mpeg").replace(/no/,"")||(e=!1)}return e}function n(e){if(e){var n=e.match(/[\d]+/g);return+(n[0]+"."+n[1])}return 0}function t(){var e,t,i=0;if(navigator.plugins&&navigator.plugins.length)e=navigator.plugins["Shockwave Flash"],i=n(e&&e.description);else if(navigator.mimeTypes&&navigator.mimeTypes.length)e=navigator.mimeTypes["application/x-shockwave-flash"],i=n(e&&e.enabledPlugin&&e.enabledPlugin.description);else try{t=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),i=n(t.GetVariable("$version"))}catch(a){}return i>=9}function i(e,n,t){return e.addEventListener?(each(n,function(n,i){t?e.addEventListener(i,n,!1):e.removeEventListener(i,n)}),t?function(){i(e,n,!1)}:void 0):void 0}var a,o,r={},u=0,d=0,c=0,f=navigator.userAgent,l=/(ipad|iphone|ipod)/i.test(f),s=/android\s2\.3/i.test(f),p=f.match(/safari/i)&&!f.match(/chrome/i),h=!p&&!f.match(/silk/i)&&f.match(/OS X 10_6_([3-7])/i),y=function(n){function f(){if(E&&o!=_){var e=P.currentTime,n=r[o];n&&n._unbind(),o=_,i(S,A,!0),g(k),P.setPosition(e)}}function p(){return!E||o==_}function h(){n=extend({autoLoad:!1},n),S=a||e(),!S&&t()?require("sound_flash",function(){S=new FlashAudio({autoLoad:n.autoLoad}),x=!0,y()}):y()}function y(){var e,n,t;if(w(),++c,_||x||(E=D),!S)return void b("unsupported");if(!_&&E&&(a=S,o=_),e=function(){if(!U){T(!1);try{S.currentTime=P.currentTime||(x?0:.01)}catch(e){}S.volume=V/100,S.muted=!1,x&&S.flashSync(),v(P.playing)}},n=function(){U?(u=0,P.duration!=S.duration&&(P.duration=S.duration,b("durationChange")),P.currentTime!=S.currentTime&&(P.currentTime=S.currentTime,b("timeUpdate"))):S.duration&&"firefox"==Device.browser&&"desktop"!=Device.type&&e()},i(S,A={play:function(){U&&(P.playing=!0,b("play"))},pause:function(){U&&(P.playing=!1,b("pause"))},canplay:e,canplaythrough:e,loadeddata:n,loadedmetadata:n,durationchange:n,timeupdate:n,progress:function(t){if(n(),t.loaded&&t.total&&t.loaded==t.total&&e(),S.buffered.length>0){var i=S.buffered.end(S.buffered.length-1);P.duration=S.duration,P.buffered=i/S.duration,b("buffer",{pct:P.buffered})}},ended:function(){n(),U&&(P.ended=!0,b("ended"))},error:function(e){var n,t=L("Ошибка загрузки"),i=L("Ошибка декодирования"),a=["",t,t,i,"Invalid source"];n=e&&e.target&&S.error?"#"+S.error.code+":"+(a[S.error.code]||t):x?e||t:t,R||(R=!0,console.error("AUDIO ERROR: "+n),3>=u?(++u,setTimeout(function(){var e=P.playing;P.load(k),v(e)},500*u)):b("error",n))}},!0),x?i(S,{flashInit:function(){b("ready")}},!0):b("ready"),I=!0,F.length)for(t=0;t<F.length;++t)P.ready(F[t])}function v(e){if(e&&f(),U){if(S.paused==e)try{e?S.play():S.pause()}catch(n){}}else C||m(),P.playing!=!!e&&b(e?"play":"pause");P.playing=!!e}function g(e){return k=e,R=!1,C=!1,T(!0),S.src=e,S.autobuffer="auto",S.preload="auto",n.autoLoad&&m(),P}function m(){S.load(),C=!0,b("loadStart")}function b(e,t){e="on"+e.substr(0,1).toUpperCase()+e.substr(1),n[e]&&n[e].apply(P,[t])}function T(e){e||U||b("loadEnd"),U=!e,U||w()}function w(){P.ended=P.playing=!1,P.buffered=P.duration=P.currentTime=0}var S,k,A,P=this,_=d++,D=!("desktop"==Device.type||l||s),E=!1,x=!1,F=[],O=!1,I=!1,R=!1,U=!1,C=!1,V=100;r[_]=P,extend(P,{load:function(e){return p()?g(e):k=e,P},isSingle:function(){return E},play:function(){return v(!0),P},pause:function(){return v(!1),P},stop:function(){return P.setPosition(0),v(!1),x&&S.flashSync(),P},destroy:function(){O||(p()&&i(S,A,!1),E&&1!=c||(x?S.flashDestory():(S.muted=!0,S.pause(),S.src="about:blank"),delete r[_],a=o=void 0),S=n=A=null,--c,O=!0)},setVolume:function(e){V=e,p()&&(S.volume=V/100,x&&S.flashSync())},setPosition:function(e){try{p()&&(S.currentTime=e,x&&S.flashSync()),P.currentTime=e}catch(n){}},_unbind:function(){i(S,A,!1),P.playing&&b("pause"),v(!1),b("buffer",{pct:P.buffered=0}),U=!1},ready:function(e){I?e&&e.apply(P,[P]):F.push(e)}}),h()};window.SpacesSound=y});define("device","init",function(){function e(e,n){var r,i,a,o,s=["","webkit","Moz","ms","O"],d=["","-webkit-","-moz-","-ms-","-o-"],f=u[e];if(!f)for(r=0,i=s.length;i>r;++r)if(a=s[r],o=t(e),a.length&&(o=a+o.charAt(0).toUpperCase()+o.substr(1)),void 0!==c.style[o]){f=u[e]=[d[r]+e,o];break}return f?f[n?0:1]:!1}function n(n,t,r){var i=e(n);return r&&(c.style[i]=t,r.test(c.style[i]+"")||(i=!1)),i}function t(e){return(e||"").replace(/-([a-z])/g,function(e,n){return(n||"").toUpperCase()})}var r,i,a,o,s,c,u,d=["requestAnimationFrame","cancelAnimationFrame"],f="spdev"+Date.now();for(r=0;r<d.length;++r)i=d[r],window[i]||(a=can_eom(window,"requestAnimationFrame"),a&&(window[i]=window[a]));o={transform:function(){var e=navigator.userAgent.indexOf("Android 2.")>-1;return(!Device.webkit()||!e)&&"operamini"!=Device.browser&&Device.css("transform","translate(1px,1px)",/translate/i)},transform3d:function(){return Device.can("transform")&&Device.css("transform","translate3d(1px,1px,1px)",/3d/i)},transition:function(){return e("transition")},sessionStorage:function(){var e,n;try{if(e=window.sessionStorage)return e.setItem(f,f),n=e.getItem(f),e.removeItem(f),n==f}catch(t){}return!1}},s={},c=ce("div"),u={},window.can_css=e,extend(Device,{css:n,webkit:function(){var e=navigator.userAgent.match(/AppleWebKit\/([\d\.]+)/);return e?parseFloat(e[1]):0},android:function(){var e=navigator.userAgent.match(/Android\s+([\d\.]+)/);return e?parseFloat(e[1]):0},can:function(e){return e in o?e in s?s[e]:s[e]=o[e]():!1}})});define("core","init",function(){function e(e){var r,R,E;for(e=extend({method:"GET",url:"",data:{},success:null,error:null,always:null,dataType:"raw"},e),R=0;R<_.length;++R)try{r=_[R]()}catch(n){}if(!r)return!1;E=e.data?t(e.data):"",r.onreadystatechange=function(){var R,t,E,n;if(4==r.readyState){r.onreadystatechange=function(){},R=0,t="";try{R=r.status}catch(o){}try{t=r.statusText}catch(o){}try{E=r.responseText}catch(o){}if(n=!(R>=200&&300>R),"json"==e.dataType)try{E=window.JSON?JSON.parse(E):light_json(E)}catch(o){n=!0}e.always&&e.always(),n?e.error&&e.error({responseText:E,status:R,statusText:t}):e.success&&e.success(E,{status:R,statusText:t})}},r.open(e.method,e.url,!0);try{r.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}catch(n){}try{r.setRequestHeader("X-Requested-With","XMLHttpRequest")}catch(n){}return r.send(E),r}function r(e){switch(e){case 501:case 502:case 503:case 504:case 403:case 404:return L("Внимание! На {0} в данный момент проводятся технические работы!",o.params.Domain);case 500:case 525:return L('Внимание! При выполнении вашего запроса, произошла внутренняя ошибка сервера!<br />Попробуйте сейчас обновить страницу, и, если ошибка повторяется, немедленно сообщите об этом в сообществе <a href="/soo/support">support</a><br />Опишите подробно, где произошла данная ошибка, в какой момент, и что нужно сделать для того, чтобы повторить данную ошибку. <br />Спасибо вам за помощь в нахождении ошибок на сайте!<br />');case 0:return L("Ошибка подключения. Проверьте ваше подключение к интернету. ");default:return L("При выполнении вашего запроса произошла ошибка HTTP: {0}",e)}}function R(e){var r,R=e.attributes,t={};for(r=0;r<R.length;++r)0==R[r].name.indexOf("data-")&&(t[css2js(R[r].name.substr(5))]=R[r].value);return t}function t(e,r){var R,t,E,n,o;r=r||"&",R=[];for(t in e)if(E=e[t],void 0!==E)if("boolean"==typeof E&&(E=E?1:0),E instanceof Array)for(n=0,o=E.length;o>n;++n)R.push(t+"="+encodeURIComponent(E[n]));else R.push(t+"="+encodeURIComponent(E));return R.join(r)}function E(e){return decodeURIComponent(e.replace(/%([^a-f0-9]{1,2}|$)/gi,"%25").replace(/\+/g," "))}function n(e){var r,R,t,n,o,_=e.split(/&amp;|&|;/),a={};for(R=0,t=_.length;t>R;++R)(r=_[R].match(/^([^=]+)=?(.*)$/))&&(n=r[1],o=E(r[2]||""),n in a?(a[n]instanceof Array||(a[n]=[a[n]]),a[n].push(o)):a[n]=o);return a}var o,_,a={COMMON:{code:0,SUCCESS:0,ERR_NEED_CAPTCHA:1,ERR_UNKNOWN_METHOD:2,ERR_USER_NOT_FOUND:3,ERR_WRONG_CAPTCHA_CODE:4,ERR_EMPTY_MESSAGE:5,ERR_UNKNOWN_ERROR:6,ERR_OFTEN_OPERATION:7,ERR_WRONG_CK:8,ERR_SMS_NOT_SEND:9,ERR_UNKNOWN_ERROR_PLEASE_RETRY:10,ERR_FORBIDDEN:11,ERR_BAD_REQUEST:12,ERR_NEED_CONFIRM_ACTION:13,ERR_USER_IN_YOUR_BLACKLIST:14,ERR_YOU_IN_USER_BLACKLIST:15,ERR_MESSAGE_TOO_LONG:16,ERR_OBJECT_NOT_FOUND:20,ERR_USER_IS_OWNER:21,ERR_USER_IS_BLOCKED:25,ERR_USER_IS_FROZEN:26,ERR_WML:28,ERR_ADULT_CONTENT:29,ERR_SPAM_CONTROL:30,ERR_WRONG_OWNER:31,ERR_NOT_ENOUGH_KARMA:32,ERR_SMALL_RATE:33,ERR_URL_NOT_FOUND:34},AUTH:{code:1,ERR_AUTH_REQUIRED:1001,ERR_ACTIVATION_REQUIRED:1008},VOTING:{code:8,ERR_VOTE_NOT_FOUND:8001},FRIENDS:{code:4,ERR_OFFER_EXISTS:4003,ERR_ALREADY_FRIENDS:4004},LENTA:{code:11,ERR_SUBSCR_NOT_FOUND:11001,ERR_SUBSCR_ALREADY_EXISTS:11003}},s=mkhash([[a.COMMON.ERR_OBJECT_NOT_FOUND,L("Объект удалён, перезагрузите страницу.")],[a.COMMON.ERR_USER_IS_FROZEN,L("Пользователь удалён")],[a.COMMON.ERR_USER_IS_BLOCKED,L("Пользователь заблокирован")],[a.COMMON.ERR_FREQ_LIMITER,L("Слишком частая операция. Подождите немного и попробуйте снова.")],[a.COMMON.ERR_USER_NOT_FOUND,L("Обитатель не найден")],[a.COMMON.ERR_MESSAGE_TOO_LONG,L("Слишком длинное сообщение")],[a.COMMON.ERR_FORBIDDEN,L("Доступ запрещён")],[a.COMMON.ERR_UNKNOWN_ERROR_PLEASE_RETRY,L("Неизвестная ошибка, повторите")],[a.COMMON.ERR_OFTEN_OPERATION,L("Слишком частая операция")],[a.COMMON.ERR_USER_IN_YOUR_BLACKLIST,L("Обитатель находится в вашем чёрном списке")],[a.COMMON.ERR_YOU_IN_USER_BLACKLIST,L("Вы находитесь в чёрном списке обитателя")]]);window.Codes=a,o={TYPES:{FILE:5,MUSIC:6,PICTURE:7,VIDEO:25,EXTERNAL_VIDEO:82},ExternalVideo:{YOUTUBE:1},KEYS:{ESC:27,PGDOWN:34,PGUP:33,HOME:36,END:35,UP:38,DOWN:40,RIGHT:39,LEFT:37,ENTER:10,MAC_ENTER:13,ALT:18},params:window.SPACES_PARAMS,sid:function(){var e,r=cookie.get("sid");return r?r:(e=location.search.match(/sid=(\d+)/),e?e[1]:"")},api:function(R,t,E,n){var _,s,c;n=extend({onError:null},n),_=R.split("/"),s="/api/",_.length>1?(s="/"+_[0]+"/",R=_[1]):R=_[1],_=R.split("."),c=_.shift(),R=_.join("."),t=t||{},t.method=R,t.CK=o.sid().slice(-4),t.sid=o.sid(),e({url:s+c,data:t,method:"POST",dataType:"json",success:function(e){return e.$code=e.code,e.code=parseInt(e.code,10),e.$error=o.apiError(e),e.code==a.AUTH.ERR_AUTH_REQUIRED?void(location.href="/registration/"):void(E&&E(e))},error:function(e){n.onError&&n.onError(r(e.status))}})},apiError:function(e){if(e.error)return e.error;switch(e.code){case a.AUTH.ERR_ACTIVATION_REQUIRED:return L("Извините, вы не можете {0}, пока не {3}подтвердите свой аккаунт{4}. Если у вас возникли проблемы с подтверждением аккаунта, обратитесь в {1}Службу тех.поддержки{2}.",e.action||"это сделать",'<a href="/soo/Support">',"</a>",'<a href="/registration/?link_id='+o.params.link_id+'">',"</a>")}return s[e.code]||L("Неизвестная ошибка: {0}",e.code)},showError:function(e){var r,R,t=ge("#common_error");t&&t.parentNode.removeChild(t),e&&(r=ge("#header_path"),R=ce("div",{className:"oh error",id:"common_error",innerHTML:e}),insert_after(R,r),R.appendChild(ce("img",{src:ICONS_BASEURL+"cross_r.gif",className:"right",onclick:function(){return o.showError(!1),!1}})),window.scrollTo(0,0))}},window.Spaces=o,_=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}],window.parse_query=n,window.node_data=R});define("video_lite","init",function(){function e(e){var n,t;if(null!==a)return a;if(a=!1,e.canPlayType)for(n=["avc1.42c00d, mp4a.40.2","avc1.42c01e, mp4a.40.2","avc1.4d401e, mp4a.40.2","avc1.64001f, mp4a.40.2"],t=0;t<n.length;++t)if(e.canPlayType('video/mp4;codecs="'+n[t]+'"')){a=!0;break}return a}var a=null;window.vplayer=function(a){var n,t,r,c,o=ge("#"+a);e(o)||(n=ge("#"+a+"_err"),insert_before(o,n),o.parentNode.removeChild(o)),"chrome"==Device.browser&&(c=function(){t&&(clearInterval(t),t=null,r=!0)},o.addEventListener("play",function(){r||(t=setInterval(function(){if(3==o.networkState){c(),r=!1,console.log("chrome save data bug!!!");try{o.load()}catch(e){}try{o.play()}catch(e){}}},500))}),each("canplaythrough durationchange canplay progress loadedmetadata".split(" "),function(e){o.addEventListener(e,c)}))},window.VideoPlayer={canPlayMP4:function(){return e(ce("video"))}}});define("music_lite","init",function(){function n(n){var i,o,u,l;if(n){for(;!hasClass(n,"player");)n=n.parentNode;return i=+n.id.replace("player_",""),player=p[i],player||(player={id:i,el:n,url:n.getAttribute("data-url"),pb:ge(".js-mpb",n)[0],pbl:ge(".js-mpbl",n)[0],time:ge(".js-mtime",n)[0],err:insert_after(ce("div",{className:"red",innerHTML:""}),n)},player.duration=player.time.innerHTML,Events.on(ge(".js-mplay",n),"click",function(n){n.preventDefault(),n.stopPropagation(),r(!c)}),l=player.pb.parentNode,Events.on(l,"click",function(n){n.preventDefault(),n.stopPropagation()}),moveable(l,function(n){if(s)if("init"==n.type){if(!f||f.id!=i)return!1}else if("start"==n.type)o=l.getBoundingClientRect(),o.width||(o={top:o.top,left:o.left,width:l.offsetWidth}),y=!0;else if("move"==n.type){var e=Math.min(1,Math.max(0,(n.x-o.left)/o.width));t(u=d.duration*e)}else"end"==n.type&&(y=!1,d.ready(function(){d.setPosition(u)}),t(u))}),p[i]=player),f&&f.id==i?void 0:(a(),f=player,e()?(r(!0),!1):void(f=null))}}function e(){if(i(""),o(!0),!d){var e=function(){f&&n(u(f.id+1)||u(0))};d=new SpacesSound({autoLoad:!0,onPlay:function(){r(!0,!0)},onPause:function(){r(!1,!0)},onEnded:e,onTimeUpdate:function(){y||t(d.currentTime),s||o(!1)},onDurationChange:function(){d.duration&&s&&o(!1)},onLoadStart:function(){o(!0)},onLoadEnd:function(){o(!1)},onBuffer:function(){f.pbl.style.width=100*d.buffered+"%"},onError:function(n){i(n),e()},onUnsupported:function(){i(L("Ваш браузер не поддерживает воспроизвидение MP3."))}})}return d.ready(function(){d.load(f.url),d.setVolume(100)}),!0}function t(n){var e=d.duration;e&&(f.pb.style.width=100*n/e+"%",f.time.innerHTML=l(n))}function i(n){o(!1),f&&(f.err.innerHTML=n)}function o(n){s=!n,toggleClass(f.pb.parentNode,g,n)}function r(n,e){toggleClass(f.el,v,n),c=n,e||d.ready(function(){n?d.play():d.pause()})}function a(){f&&(r(!1),o(!1),t(0),f.pbl.style.width="0%",f.time.innerHTML=f.duration,f=null)}function u(n){var e=ge("#player_"+n);return e&&"video"==e.getAttribute("data-type")?u(n+1):e}function l(n){var e,t,i,o=Math.floor(n/3600);return n-=3600*o,e=Math.floor(n/60),t=Math.floor(n-=60*e),i='<span class="hid">0</span>',(o?(10>o?i+o:o)+":":"")+(10>e?(o?"0":i)+e:e)+":"+(10>t?"0"+t:t)}var f,d,p={},c=!1,s=!1,y=!1,m=0,g="progress-item__runner_anim",v="playing";window.Music={init:n},define("music_lite","onRequire",function(){Loader.ready(function(){tick(function(){each(ge(".player"),function(n){n.id||(n.id="player_"+m++)})})})})});define("likes","init",function(){function e(e){var i,r,o,a,d,s="#like_",c=ge(s+"down"+e),l=ge(s+"up"+e),_=ge(s+"cnt"+e),g=dattr(l,"ot"),u=dattr(l,"oid"),f=g+"_"+u,v=(dattr(l,"mode")||"full",+dattr(l,"cnt")),p=c?+dattr(c,"cnt"):0,b=c&&c.getElementsByTagName("img")[0],w=l.getElementsByTagName("img")[0],k=[ge(s+"up_cnt"+e),ge("#vote_up_cnt_"+e)],h=[ge(s+"down_cnt"+e),ge("#vote_down_cnt_"+e)],m=ge("#subscribe_offer_"+g+"_"+u),E=!1;Spaces.params.nid&&(r=function(){var e=ge("#vote_err_"+f);return!e&&(e=find_parents(l,".js-action_bar",1))?ge(".js-vote_error",e)[0]:e},o=function(){var e=r();e&&(addClass(e,"hide"),clearTimeout(i))},a=function(e){var t=r();t?(removeClass(t,"hide"),t.innerHTML=e,i=setTimeout(o,4e3)):Spaces.showError(e)},d=function(e){var i,r,o,s,T,C,y,j,O,H,M,N,S=this==l,D=dattr(this,"subscr"),R=(dattr(this,"clicked"),+dattr(l,"disabled")||+dattr(this,"disabled")),G=dattr(l,"binded");if(e&&(i=ge("#vote_err_"+f),i&&addClass(i,"hide")),R){if(!Spaces.params.nid)return;return a(L("Вы не можете голосовать за себя.")),!1}if(G)return r=ge("#"+(S?"like_up":"like_down")+G),r&&r.click(),!1;if(e&&e.preventDefault(),E)return!1;if(o=c&&+dattr(c,"clicked"),s=+dattr(l,"clicked"),T=!1,C=!1,s||o?S&&!s?(++v,--p,C=!0):S||o?(S?--v:--p,T=!0):(--v,++p,C=!0):S?++v:++p,s=!T&&S,o=!T&&!S,_&&(y=v-p,toggleClass(_,"red",0>y),toggleClass(_,"green",y>0),_.innerHTML=y),j=function(e,t){var n,i;for(n=0;n<e.length;++n)i=e[n],i&&(dattr(i,"hideable")&&toggleClass(i,"hide",!t),i.innerHTML=t)},w)for(O=0;O<t.length;++O)w.src=w.src.replace(RegExp(t[O].join("|"),"g"),t[O][s?0:1]);if(j(k,v),c){if(b)for(O=0;O<n.length;++O)b.src=b.src.replace(RegExp(n[O].join("|"),"g"),n[O][o?0:1]);j(h,p)}return l.setAttribute("data-clicked",+s),c&&c.setAttribute("data-clicked",+o),H=ge("#voted_"+g+"_"+u),H&&!o&&addClass(H,"hide"),window.Gallery&&Gallery.onLike({oid:u,ot:g,dir:o?-1:s?1:0,cntUp:v,cntDown:p}),e?(M=T?"neoapi/voting.delete":"neoapi/voting.like",N={CK:null,Oid:u,Ot:g,Widgets:D&&!!m,Link_id:Spaces.params.link_id},T||(N.Down=S?0:1),E=!0,Spaces.api(M,N,function(e){E=!1,0==e.code&&e.warn&&a(e.warn),0==e.code&&o&&H&&removeClass(H,"hide"),0!=e.code&&e.code!=Codes.VOTING.ERR_VOTE_NOT_FOUND&&(a(e.$error),d.call(C?S?c:l:S?l:c)),m&&(e.widgets&&e.widgets.author?(m.style.display="",ge(".js-subscribe_offer_object",m)[0].innerHTML=e.widgets.author,ge(".js-subscribe_offer_button",m)[0].innerHTML=e.widgets.subscr_link):m.style.display="none")},{onError:function(e){E=!1,a(e)}}),!1):void 0},Events.off(l),Events.on(l,"click",d),c&&(Events.off(c),Events.on(c,"click",d)))}var t=[["vote/up_on","vote/up"],["action_bar/vote_up_on","action_bar/vote_up"]],n=[["vote/down_on","vote/down"],["action_bar/vote_down_on","action_bar/vote_down"]];window.likes=function(t){Loader.ready(function(){e(t)})}});define("form_toolbar","init",function(){function addEvent(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent("on"+t,a)}function getSelectionRange(e,t){var a,n,o,r=0,l=0;if(void 0!==e.selectionStart)r=e.selectionStart,l=e.selectionEnd-e.selectionStart;else{if(!document.selection||!e.createTextRange)return null;lock_events=!0,e.focus(),a=e.value.length,n=document.selection.createRange(),l=n.text.length,o=e.createTextRange(),o.moveToBookmark(n.getBookmark()),r=-o.moveStart("character",-a),t&&e.blur(),lock_events=!1}return[r,l]}function textInsertTag(e,t,a,n){var o;textReplaceTag(e,function(e,r){var l=e||n;return r&&(o=r[0]+t.length+l.length),t+l+a}),o&&set_caret_pos(e,o,o)}function textReplaceTag(e,t){var a,n,o=getSelectionRange(e),r=[e.scrollLeft,e.scrollTop];o?(a=t(e.value.substr(o[0],o[1]),o),n=o[0]+a.length,e.value=e.value.substr(0,o[0])+a+e.value.substr(o[0]+o[1]),e.focus()):(e.value+=t(""),n=e.value.length),e.focus(),set_caret_pos(e,n,n),e.scrollLeft=r[0],e.scrollTop=r[1]}function initToolbars(textareas){var i,ta,data;for(i=0;i<textareas.length;++i)ta=textareas[i],data=ta.getAttribute("data-toolbar"),data&&!ta.toolbar&&(ta.toolbar=new Toolbar(ta,eval("("+data+")")))}var tpl,lock_events,Toolbar,TOGGLE_TOOLBAR_ICO=["dots_light.png","dots_grey.png"],IS_WAP=!Device.touch_light,ICO_SPINNER=ICONS_BASEURL+"spinner2.gif",ITEM_WIDTH=Device.touch_light?32:21,TOOLBAR_ITEMS={quote:["bb/grey2/quote.png",L("Вставить цитату")],url:["bb/grey2/link.png",L("Вставить ссылку")],attach:["ico/plus_grey.png",L("Вставить")],color:["bb/grey2/color.png",L("Цветной текст")],b:["bb/grey2/bold.png",L("Жирный текст")],i:["bb/grey2/italics.png",L("Наклонутый текст")],u:["bb/grey2/underline.png",L("Подчёркнутый текст")],s:["bb/grey2/strike.png",L("Зачёркнутый текст")],smile:["bb/grey2/smile.png",L("Смайлы")],code:["bb/grey2/code.png",L("Код")],fon:["bb/grey2/bg.png",L("Фон текста")],more:[TOGGLE_TOOLBAR_ICO[0],L("Ещё")]},COLORS=["90CAF9 80DEEA A5D6A7 FFF59D FFCC80 FFAB91 CE93D8".split(" "),"2196F3 00BCD4 4CAF50 FFEB3B FF9800 F44336 9C27B0".split(" "),"1565C0 00838F 2E7D32 F9A825 EF6C00 C62828 6A1B9A".split(" "),"ECF0F1 CFD8DC B0BEC5 97A6B0 546E7A 44565E 3A474C".split(" ")];IS_WAP&&(delete TOOLBAR_ITEMS.smile,delete TOOLBAR_ITEMS.code),tpl={toolbar:function(e){if(e.hide&&IS_WAP)return"";var t=IS_WAP?"":'<table class="bb_table'+(e.hide?" hide":"")+'" id="bbtable_'+e.id+'"><tr>';return each(TOOLBAR_ITEMS,function(a,n){e.disable.bgcolor&&"fon"==n||IS_WAP&&"more"==n||("attach"!=n||e.attach)&&(t+=(IS_WAP?"":'<td class="bb_cell">')+'<a href="#bb_'+n+'" data-tag="'+n+'" class="js-bb bb bb_'+n+'" title="'+a[1]+'" id="'+e.id+"-"+n+'"><img src="'+ICONS_BASEURL+a[0]+'" alt="" class="m" /></a>'+(IS_WAP?"":"</td>"))}),t+=IS_WAP?"":'</tr><tr class="hide"></tr><tr class="hide"></tr><tr class="hide"></tr></table>',t+='<div id="bbmenu_'+e.id+'"></div>'},length:function(e){return'<span class="right counterBlock"><span id="tcounter_'+e.id+'">0</span>/'+e.maxlength+"</span>"},colors:function(e){var t='<div class="spo_inj-wrap"><div class="spo_inj"><div class="block t_center bord">';return each(COLORS,function(a){t+="<div>",each(a,function(a){t+='<a href="#'+a+'" style="background:#'+a+'" data-val="#'+a+'" data-tag="'+e+'" class="bbcolor js-bb">&nbsp;</a>'}),t+="</div>"}),t+"</div></div></div>"}},lock_events=!1,Toolbar=function(e,t){function a(){var a,n,o,d,b;if(t=extend({toolbar:!0,hide:!1,disable:{}},t),t.toolbar||(t.hide=!0),p||(p=ce("div",{className:"cf"}),t.toolbar?e.parentNode.insertBefore(p,h):insert_after(p,e)),a=ge("#active_attaches"),a&&a.parentNode.removeChild(a),addClass(p,"toolbar"),p.innerHTML=(v&&"operamini"!=Device.browser?tpl.length({id:_,maxlength:v}):"")+tpl.toolbar({id:_,disable:t.disable,hide:t.hide,attach:a})+(t.hide?"&nbsp":""),a&&(n=ge("#"+_+"-attach"),insert_after(a,n),n.parentNode.removeChild(n),a.id=n.id,addClass(a,"bb"),addClass(a,"js-bb"),addClass(a,"js-bb_attach")),removeClass(p,"js-on_hide"),l(),"operamini"!=Device.browser&&v&&(e.onfocus=function(){lock_events||(g=setInterval(i,300),tick(s))},e.onblur=function(){lock_events||(clearInterval(g),s(!0))},i()),!IS_WAP)for(t.toolbar&&(addEvent(window,"resize",r),addEvent(window,"orientationchange",r),tick(r),setTimeout(r,1e3)),o=document.getElementsByTagName("input"),d=0;d<o.length;++d)b=o[d],"smiles_btn"==b.name?b.onclick=function(){return ge(".bb_smile",p)[0].click(),!1}:hasClass(b,"js-bb_toggle")&&(b.onclick=function(){return c(t.hide),!1})}function n(){var t,a,n=this,l=n.getElementsByTagName("img")[0],i=n.getAttribute("data-tag"),s=n.getAttribute("data-val");if(i)return"smile"==i?(o(null),l.src=ICO_SPINNER,require("smiles_menu",function(){l.src=ICONS_BASEURL+"smile_light.png",SmilesMenu.toggle(_,p,function(t){textReplaceTag(e,function(){return t+" "})})})):"color"!=i&&"fon"!=i||s?"more"==i?(m=0,T=!T,r()):"url"==i?textReplaceTag(e,function(e){if(e.length)return"[url="+e+"]"+L("ссылка")+"[/url]";var t=ge("#toolbar_payload"),a=t?t.getAttribute("data-clipboard"):"";return a?html_unwrap(a):"[url="+location.protocol+"//"+base_domain()+"]"+L("ссылка")+"[/url]"}):(t={color:"green",fon:"LightBlue",gray:"#ccc"},a=s||t[i],textInsertTag(e,"["+i+(a?"="+a:"")+"]","[/"+i+"]",""),o(!1)):o(i,C==i?!1:tpl.colors(i)),!1}function o(e,t){var a,n=ge("#sm_exit_"+_);n&&n.click(),a=ge("#bbmenu_"+_),a.innerHTML=t||"",toggleClass(a,"hide",!t),C=t?e:!1,l()}function r(){var e,a,n,o,r,l,i,s,c,g,u,h=ge("#bbtable_"+_),f=ge(".js-bb",h),v=p.clientWidth-(b?b.parentNode.clientWidth:0),C=Math.max(4,Math.floor(Math.min(v,(f.length-1)*ITEM_WIDTH)/ITEM_WIDTH));if(toggleClass(h,"hide",t.hide),m!=C&&!t.hide){for(e=[],a=h.getElementsByTagName("tr"),n=(f.length-1)/C,r=0,l=0;f.length>0;)i=f[r],s=i.getAttribute("data-tag"),"more"!=s?(c=Math.floor((n>1?l+1:l)/C),(e[c]||(e[c]=[])).push(i.parentNode),++l):o=i.parentNode,d(i.parentNode);for(r=0;r<e.length;++r)for(g=e[r],u=0;u<g.length;++u)a[r].appendChild(g[u]);for(a[0].appendChild(o),e[1]?removeClass(o,"hide"):addClass(o,"hide"),o.getElementsByTagName("img")[0].src=ICONS_BASEURL+TOGGLE_TOOLBAR_ICO[+T],r=1;r<a.length;++r)toggleClass(a[r],"hide",r>n||!T);m=C}}function l(){var e,t=ge(".js-bb",p);for(e=0;e<t.length;++e)t[e].onclick=n}function i(){b||(b=ge("#tcounter_"+_));var t=e.value.length;b.innerHTML=t,b.style.color=t>v?"red":""}function s(t){u||(u=ce("input",{type:"hidden",name:"toolbar_cursor",value:"0,0"}),p.appendChild(u)),u.value=(getSelectionRange(e,t)||[0,0]).join(",")}function c(e){m=0,t.hide=!e,r()}function d(e){e.parentNode.removeChild(e)}var g,b,u,h=this,_="tb_"+Date.now(),f=find_parents(e,".js-toolbar_wrap",!0),p=ge(".js-toolbar",f)[0],v=+(e.getAttribute("maxlength")||e.getAttribute("data-maxlength")||0),m=0,T=!1,C=!1;a(),this.toggle=c},define("form_toolbar","onRequest",function(){Loader.ready(function(){initToolbars(document.getElementsByTagName("textarea")),initToolbars(document.getElementsByTagName("input"))})})});define("subscribe","init",function(){function e(){Events.glob("click",{".js-subscr_link":function(){return i=this,d=node_data(i),d.error?void 0:(d.rand?n(ge("#"+d.sub+"_confirm_"+d.type+"_"+d.rand)):r(),!1)},".js-subscr_ok":function(){return r(),!1},".js-subscr_cancel":function(){return a(),!1}})}function r(){var e,r,n={friend:{add:{method:"neoapi/friends.offer",friends:"revoke"},revoke:{method:"neoapi/friends.revokeOffer",friends:"add"},"delete":{method:"neoapi/friends.delete",friends:"add",lenta:"add"}},lenta:{add:{method:"neoapi/lenta.authorAdd",lenta:"delete"},"delete":{method:"neoapi/lenta.authorDelete",lenta:"add"}}},o=n[d.sub][d.type],u={CK:null};if("lenta"==d.sub?(u.Aid=d.author_id,u.At=d.author_type):u.user=d.user,e=s&&s.getElementsByTagName("textarea")[0]){if(e=e.value,e.length>100)return Spaces.showError(L("Длина сообщения не должна превышать 100 символов.")),!1;u.message=e}r=i.getElementsByTagName("a")[0],Spaces.api(o.method,u,function(e){var n=e.code==Codes.LENTA.ERR_SUBSCR_ALREADY_EXISTS||e.code==Codes.LENTA.ERR_SUBSCR_NOT_FOUND||e.code==Codes.FRIENDS.ERR_OFFER_EXISTS||e.code==Codes.FRIENDS.ERR_ALREADY_FRIENDS;e.captcha_url&&r?location.assign(r.href):0==e.code||n?(e.offer_accepted?(t("friend","delete"),t("lenta","delete")):(o.friends&&t("friend",o.friends),o.lenta&&t("lenta",o.lenta)),a()):Spaces.showError(e.$error)},{onError:function(e){Spaces.showError(e)}})}function t(e,r){var t,n,a,o,s,i=ge(".js-subscr_link");for(t=0;t<i.length;++t)n=i[t],a=node_data(n),o=a.author_id&&d.author_id==a.author_id&&d.author_type==a.author_type,s=a.user&&d.user==a.user,(o||s)&&e==a.sub&&toggleClass(n,"hide",a.type!=r)}function n(e){var r,t=s&&s.id==e.id;a(),t||(r=o(i),s=e,removeClass(s,"hide"),insert_after(s,r))}function a(){s&&(addClass(s,"hide"),insert_after(s,i),s=null)}function o(e){for(var r,t,n,a=e;a;){if(1==a.nodeType)for(t=a.tagName.toLowerCase(),n=0;n<u.length;++n)if(hasClass(a,u[n])){r=a;break}a=a.parentNode}return r||e}var d,s,i,u=["js-row","wrapper"];Loader.ready(e)});define("comments","init",function(){function e(){Events.bulk(ge(".js-comm_reply"),{click:function(){var e,i=this,n=ge("#comments_form_wrap"),o=ge("#comments_form"),c=ge("#comments_form_reply"),r=o.getElementsByTagName("textarea")[0],a=t(i),l=o.parentNode!=n,m=!!ge(".comm_hidden",a)[0],d=document.getElementsByName("hideComment")[0],s=ge("#comments_form_user"),g=find_parents(s,"form",!0),u=g.getAttribute("data-comm_id");return l?(n.appendChild(o),g.action=g.getAttribute("data-action"),u!=a.id&&tick(function(){i.click()}),d&&(d.checked=!1),r.toolbar&&r.toolbar.toggle(!1)):(insert_after(o,a),g.setAttribute("data-action",g.action),g.setAttribute("data-comm_id",a.id),g.action=i.href,d&&(d.checked=m),r.toolbar&&r.toolbar.toggle(!0)),toggleClass(i,"js-clicked",!l),toggleClass(c,"hide",l),e=ge(".mysite-link",a)[0],s.innerHTML=e.parentNode.innerHTML.replace(/^\s+|\s+$/g,""),!1}},!0),Events.bulk(ge(".js-link_copy"),{click:function(){var e,n,o,c,r=this;return i&&i!=r?(i.click(),tick(function(){r.click()}),!1):(e=t(r),n=ge("#m"+e.id),o=ge("#tpl-comments_link"),c=!hasClass(n,"hide"),c?i=null:(n.appendChild(o),i=r,ge("#comm_do_copy_link").href=r.getAttribute("data-copy"),ge("#comm_copy_link").value="[url="+e.getAttribute("data-link")+"]"+L("Ссылка на комментарий")+"[/url]"),toggleClass(n,"hide",c),!1)}},!0)}function t(e){for(;e&&!/^\d+$/.test(e.id);)e=e.parentNode;return e}if(Device.touch_light&&"operamini"!=Device.browser){var i;Loader.ready(e)}});define("events","init",function(){function n(){this.returnValue=!1}function e(){this.cancelBubble=!0}function t(t){return t=t||window.event,t[a]?t:(t[a]=!0,t.preventDefault=t.preventDefault||n,t.stopPropagation=t.stopPropagaton||e,t.target||(t.target=t.srcElement),t)}function r(n,e,t){var i,u;if(f(n)){for(i=0;i<n.length;++i)r(n[i],e,t);return n}return u=n[a]||(n[a]=[null,{}]),u[0]||(u[0]=function(e){return o.call(n,e)}),e=e.split(/\s+/),each(e,function(e){u[1][e]||(u[1][e]=[],n.addEventListener?n.addEventListener(e,u[0],!1):n.attachEvent("on"+e,u[0])),u[1][e].push(t)}),n}function i(n,e,t){var r,o,u,c;if(f(n)){for(r=0;r<n.length;++r)i(n[r],e,t);return n}if(e=e||"*",o=n[a]){if("*"==e){u=[];for(c in o[1])u.push(c);return i(n,u.join(" "),t)}e=e.split(/\s+/),each(e,function(e){var r,i=o[1][e];if(i){if(t)for(r=i.length-1;r>=0;r--)i[r]===t&&i.splice(r,1);t&&i.length||(delete o[1][e],n.removeEventListener?n.removeEventListener(e,o[0],!1):n.detachEvent("on"+e,o[0]))}});for(c in o[1])return;try{delete n[a]}catch(l){elem.removeAttribute(a)}}return n}function o(n){var e,r;for(n=t(n),e=this[a][1][n.type],r=0;r<e.length;++r)e[r].call(this,n)===!1&&n.preventDefault()}function u(n,e,t){each(e,function(e,o){(t?r:i)(n,o,e)})}function f(n){return"length"in n&&(0 in n||!n.length)&&n.window!=window}var a="se"+Date.now();window.Events={on:r,off:i,bulk:u,glob:function(n,e,t){each(e,function(e,r){var i=ge(r,t);i&&u(i,mkhash([[n,e]]),!0)})}}});define("touch","init",function(){function e(e,t){function o(e){return a="touchstart"==e.type,p||e.touches&&e.touches.length>1||t({type:"init"})===!1?void 0:(p=!0,c(!0),n(e,!0),"ucbrowser"==Device.browser?!1:void 0)}function n(e,o){if(p&&(!a||0==e.type.indexOf("touch"))){o||i(e);var n=e.touches;n?(v=n[0].pageY,s=n[0].pageX):(s=e.pageX,v=e.pageY,void 0===s&&(s=e.clientX,v=e.clientY)),o&&(r=s,d=v,t({x:s,y:v,dx:s-r,dy:v-d,type:"start"})),t({x:s,y:v,dx:s-r,dy:v-d,type:"move"})}}function u(e){return!p||e.touches&&e.touches.length>0||a&&0!=e.type.indexOf("touch")?void 0:(t({x:s,y:v,dx:s-r,dy:v-d,type:"end"}),i(e),p=!1,c(!0),!1)}function c(e){Events.bulk(document,{mousemove:n,mouseup:u},e)}function i(e){e.preventDefault(),e.stopPropagation()}var r,d,s,v,a,p=!1;Events.bulk(e,{mousedown:o,touchstart:o,touchmove:n,touchend:u,touchcancel:u},!0),"msie"==Device.browser&&Device.v<=8&&Events.on(document,"mousedown",function(t){for(var n=t.target||t.srcElement;n;){if(n===e)return o.apply(n,[t]);n=n.parentNode}})}window.moveable=e});define("gallery","init",function(){function e(){var e,n,s,o=!R&&VideoPlayer.canPlayMP4(),d=ge(".gview_link");for(e=0;e<d.length;++e)n=d[e],s=f(n),s.image&&("video"!=s.content||o&&!R)&&("video"!=s.content||ge(".js-vp",n).length)&&(n.onclick=a,K[s.gid]||(K[s.gid]=[]),s.n=K[s.gid].length,K[s.gid].push(s));m("gallery")&&(l(),h("gallery",!1)),U&&window.addEventListener("popstate",function(){M&&!m("gallery")&&t(!0),!M&&m("gallery")&&(l()||h("gallery",!1))},!1),Events.bulk(window,{resize:i,orientationchange:i,keydown:r},!0)}function l(){var e=m("gallery");e&&tick(function(){return e=e.split("/"),K[e[0]]&&K[e[0]][e[1]]?(K[e[0]][e[1]].el.click(),!0):void 0})}function a(){var e,l,a,r;return M?!1:(N=!1,A=w(),e=f(this),l="gtop"+Date.now(),addClass(document.body,"gallery__open"),addClass(document.body,"gallery__doc"),addClass(document.documentElement,"gallery__doc"),document.body.appendChild(ce("div",{innerHTML:B.gallery({gtop:l})}).firstChild),T=ge("#Gallery"),toggleClass(T,"gallery__pc",Device.pc),s(e.gid,e.n),Events.glob("click",{".gallery__side":function(){return n(+this.getAttribute("data-dir")),!1},".js-gal_exit":function(){return t(),!1},".js-gal_zoom":function(){return v(!V),!1},"#gallery__gif_play":function(){return p(H?M.image:M.gif),H=!H,!1},".js-gal_fs":function(){return G=!G,toggleClass(T,"gallery__fullscreen",G),i(),!1},".gallery__link":function(){var e,l,a,t;return hasClass(this,"disabled")?(e=this.getElementsByTagName("a")[0],l=L("video"==M.content?"видео":"фото"),a=Spaces.params.nid,t={g_advancepage:L("У этого {0} нет комментариев.",l),g_sharelink:a?L("Это {0} нельзя сохранять в коллекции.",l):B.onlyAuthMotivator(),like_up_gallery:a?L("Это {0} нельзя лайкать.",l):B.onlyAuthMotivator(),like_down_gallery:a?L("Это {0} нельзя дислайкать.",l):B.onlyAuthMotivator()},g(t[e.id]),!1):void 0}}),tick(i),R||(a=0,r=setInterval(function(){T&&1!=a||clearInterval(r),++a,T&&toggleClass(T,"gallery-arrows")},800)),R&&(location.hash="#"+l),!1)}function t(e){return U&&!e?void history.back():void(T&&(removeClass(document.body,"gallery__open"),removeClass(document.body,"gallery__doc"),removeClass(document.documentElement,"gallery__doc"),document.body.style.cssText="",T.parentNode.removeChild(T),M=T=null,window.scrollTo(0,A),tick(function(){window.scrollTo(0,A)})))}function r(e){if(M){var l=e.keyCode||e.which;return l==Spaces.KEYS.ESC?t():l==Spaces.KEYS.UP?v(!0):l==Spaces.KEYS.DOWN?v(!1):l==Spaces.KEYS.LEFT?n(-1):l==Spaces.KEYS.RIGHT&&n(1),!1}}function i(){var e,l,a,t,r,i;M&&(e=Math.max(window.innerHeight,document.documentElement.clientHeight||0),e&&(document.body.style.cssText="min-height:"+e+"px !important"),j=k(),M.gif&&(l=ge("#gallery__gif_play"),l.style.top=(j.h-l.offsetHeight)/2+"px"),"video"==M.content&&(a=ge("#gallery_video_wrap"),t=b(j.w,j.h),a.style.width=t[0]+"px",a.style.marginTop=(j.h-t[1])/2+"px"),r=ge(".gallery__error",T)[0],r&&(i=(j.w-r.offsetWidth)/2,r.style.marginLeft=i/2+"px",r.style.marginRight=i/2+"px"),R&&(T.height=j.h+"px",T.width=j.w+"px"))}function n(e){var l=M.n+e,a=K[M.gid];0>l&&(l=a.length-1),l>=a.length&&(l=0),s(M.gid,l)}function s(e,l){var a,t,r,n,s,o,c,u,f,m,w;M&&M.adult&&y(!1),H=!1,a=ge("#g_advancepage"),t=ge("#g_sharelink"),r=ge("#g_dloadlink"),n=K[e],s=n[l],"video"==s.content?(o=ge(".js-vp",s.el)[0],c={preview:o.getAttribute("data-preview"),exId:o.getAttribute("data-external-id"),exType:o.getAttribute("data-external"),sources:light_json(o.getAttribute("data-src"))},ge("#gallery_video_wrap").innerHTML=B.video(c)):p(s.image),toggleClass(T,"gallery__gif",!!s.gif),toggleClass(T,"gallery__video","video"==s.content),t.href=s.share,r.href=s.download,a.href=s.commentsLink,toggleClass(t,"mr_l_0",s.shareCnt>0),toggleClass(a,"mr_l_0",s.commentsCnt>0),toggleClass(t.parentNode,"js-clicked",!!+s.reposted),toggleClass(t.parentNode,"disabled",!s.share||s.share.indexOf("#no_link")>=0),toggleClass(a.parentNode,"disabled",!s.commentsLink||s.commentsLink.indexOf("#no_link")>=0),r.style.display=s.download?"":"none",ge("#g_shareCnt").innerHTML=+s.shareCnt||"",ge("#g_commentCnt").innerHTML=+s.commentsCnt||"",u=+l,f=n.length,ge("#gallery_cnt").innerHTML=L("{0} из {1}",u+1,f),toggleClass(T,"one_image",2>f),m=u?u-1:f-1,w=u==f-1?0:u+1,R||(ge("#gallery_preload_0").src=m!=u?n[m].image:I,ge("#gallery_preload_1").src=w!=u&&m!=w?n[w].image:I),M=s,v(!1),d(),i(),h("gallery",e+"/"+l),s.adult&&_(),s.share&&!S&&s.showMotivator&&tick(function(){g(B.collectionsMotivator({link:s.share}),function(){S=!0})})}function o(e){if(M){if(!M.parent&&e.ot==M.type&&e.oid==M.nid){var l=M.like.split(",");l[0]=e.dir,l[1]=e.cntUp,l[2]=e.cntDown,M.like=l.join(",")}d()}}function d(){var e,l,a,t,r,i=M.like.split(","),n=!1;M.parent&&(e=M.parent.split(":"),l=e[0]+"_"+e[1],a=ge("#like_up"+l),t=ge("#like_down"+l),i=[0,0,0,1,1],a&&(i=[+dattr(a,"clicked")?1:t&&+dattr(t,"clicked")?-1:0,dattr(a,"cnt"),t?dattr(t,"cnt"):0,+dattr(t,"disabled"),!t],n=l)),r=Spaces.params.nid&&!+i[3]&&M.type!=Spaces.TYPES.EXTERNAL_VIDEO,each(ge(".js-vote_btn",T),function(e){var l,a=ge(".js-vote_btn_cnt",e)[0],t=(M.type+"_"+M.nid,+e.getAttribute("data-type")),s=0>t?+i[2]:+i[1];toggleClass(a,"mr_l_0",s>0),a.innerHTML=s||"",e.id="like_"+(0>t?"down":"up")+"_gallery",l={ot:M.type,oid:M.nid,clicked:i[0]==t,mode:"gallery",disabled:!(r&&(-1!=t||!i[4])),cnt:s,binded:n||""},each(l,function(l,a){"boolean"==typeof l&&(l=+l),e.setAttribute("data-"+a,l)}),toggleClass(e.parentNode,"disabled",l.disabled),toggleClass(e.parentNode,"js-clicked",i[0]==t)}),require("likes",function(){likes("_gallery")})}function c(){var e=ge("#gallery_notif");e&&e.parentNode.removeChild(e)}function g(e,l){c(),T.appendChild(ce("div",{innerHTML:B.notif({text:e})}).firstChild),Events.on(ge(".js-gal_notif_close",T)[0],"click",function(){return l&&l(),c(),!1})}function _(){y(B.adult(L("video"==M.content?"видео":"фото"))),Events.on(ge(".gallery_error-side",T),"click",function(){return n(hasClass(this,"prev")?-1:1),!1}),Events.on(ge("#gallery_adult_show"),"click",function(){return y(!1),Spaces.api("neoapi/session.adultCheck",{passed:1}),each(P,function(e){e.adult=0}),!1})}function y(e){var l,a=ge("#gallery_img");toggleClass(a.parentNode,"gallery__show_error",!!e),l=ge(".gallery__error",T)[0],l.innerHTML=e||"",i()}function p(e){var l=ge("#gallery_img");l.parentNode.replaceChild(ce("img",{id:l.id,src:e,className:l.className}),l)}function u(e){var l,a,t,r,i,n={el:e,link:e.href},s=e.getAttribute("g");if(s){for(l=s.split("|"),a=0,t=D.length;t>a;++a)r=D[a],i=l[a],"#"==r.substr(0,1)&&(r=r.substr(1),i=+i||0),n[r]=i;return n.gif&&(n.gif=n.download),n.commentsLink||(n.commentsLink=n.link),n}}function v(e){var l,a,t;W&&V!=e&&(V=e,toggleClass(T,"gallery__zoom",e),l=M.image,a=ge("#gallery_img"),e?(addClass(T,"gallery__loading"),C(M.download,function(e,t){if(M&&M.image==l&&V&&(removeClass(T,"gallery__loading"),t)){if(!a.getAttribute("data-zoom-ok")){var r=x(l);a.width?(a.style.width=a.width+"px",a.style.height=a.height+"px"):r&&(a.style.maxWidth=r[0]+"px",a.style.maxHeight=r[1]+"px"),a.setAttribute("data-zoom-ok",1)}a.src=e}})):(removeClass(T,"gallery__loading"),a.src=l),e?(O={x:0,y:0},a.style[W]=E(2,0,0),N||(t=ge("#gallery_img_wrap"),moveable(t,function(e){if("init"==e.type)return a=ge("#gallery_img"),V;var l=e.dx+O.x,t=e.dy+O.y;Math.abs(l)-a.offsetWidth/2>=0&&(l=nsign(l)*(a.offsetWidth/2)),Math.abs(t)-a.offsetHeight/2>=0&&(t=nsign(t)*(a.offsetHeight/2)),"move"==e.type?a.style[W]=E(2,l,t):"end"==e.type&&(O.x=l,O.y=t)}),N=!0)):(O=!1,a.style[W]="none"))}function f(e){if("gallery_cache_id"in e)return P[e.gallery_cache_id];var l=u(e);return e.gallery_cache_id=P.length,P.push(l),l}function h(e,l){if(U){var a=location.href.replace(/#.*?$/,"")+(l?"#"+e+"/"+l:"");0==location.hash.indexOf("#"+e+"/")?history.replaceState({},document.title,a):l&&history.pushState({},document.title,a)}}function m(e){if(!U)return!1;var l;return(l=location.hash.match(RegExp("^#"+e+"/(.*?)$","i")))?l[1]:!1}function w(){if(void 0!==window.pageYOffset)return window.pageYOffset;var e=document.body,l=document.documentElement;return(e.clientHeight?e:l).scrollTop}function k(){var e=R?screen.availHeight:T.offsetHeight;return{x:0,y:G?0:Y,h:e-(G?0:Y+z),rh:e,w:T.offsetWidth}}function b(e,l){var a,t,r=16/9;return e*r==l?[e,l]:(a=e/r,t=l*r,a>l?[Math.round(t),Math.round(t/r)]:[Math.round(a*r),Math.round(a)])}function x(e){var l=e.match(/\.\w+\.(\d+)\.(\d+)/);return l&&[l[1],l[2]]}function C(e,l){var a=new Image;a.onload=function(){l.call(a,e,!0)},a.onerror=function(){l.call(a,e,!1)},a.src=e,a=null}function E(e,l,a){return q?"translate3d("+l+"px, "+a+"px, 0px) scale3d("+e+", "+e+", 1)":"translate("+l+"px, "+a+"px) scale("+e+")"}var S,M,T,j,A,H,N,O,I=ICONS_BASEURL+"transparent.gif",Y=40,z=40,D=["#nid","#type","gid","content","preview","shareCnt","commentsCnt","download","share","gif","image","commentsLink","#adult","like","reposted","resolution","parent","#extType","#showMotivator"],R=""+window.operamini=="[object OperaMini]",U=window.history&&window.history.pushState&&!R,W=!R&&Device.can("transform"),q=W&&Device.can("transform3d"),B={gallery:function(e){var l=R?"a":"span",a='<div id="Gallery" class="gallery"><a name="'+e.gtop+'"></a><div class="gallery__shadow"></div><div class="gallery__header gallery__header_fs"><div class="gallery__header_inner"><div class="gallery__tools_place">&nbsp;</div><a class="gallery__tools_button js-gal_fs" href="#fullscreen"><span class="ico_gallery ico_gallery_fullscreen"></span></a><div class="gallery__tools_place gallery__tools_button">&nbsp;</div></div><div class="gallery__loader"></div></div><div class="gallery__header" id="gallery_tools"><div class="gallery__header_inner"><a class="gallery__tools_button" href="" id="g_dloadlink" target="_blank"><span class="ico_gallery ico_gallery_download m"></span></a><div class="gallery_cnt" id="gallery_cnt"></div>'+(W?'<a class="gallery__tools_button js-gal_zoom" href="#zoom"><span class="ico_gallery ico_gallery_zoom m"></span></a>':"")+'<a class="gallery__tools_button js-gal_fs" href="#fullscreen"><span class="ico_gallery ico_gallery_fullscreen m"></span></a><a class="gallery__tools_button js-gal_exit" href="#gallery_exit"><span class="ico_gallery ico_gallery_exit m"></span></a></div><div class="gallery__loader"></div></div><div class="gallery__image-wrapper" id="gallery_img_wrap"><'+l+' class="gallery__side gallery__side_prev" data-dir="-1" href="#gprev"><div class="gallery__side-arrow ico_gallery ico_gallery_arrow_left"></div></'+l+"><"+l+' class="gallery__side gallery__side_next" data-dir="1" href="#gnext"><div class="gallery__side-arrow ico_gallery ico_gallery_arrow_right"></div></'+l+'><img src="'+I+'" alt="" id="gallery_img" class="gallery__image" /><div class="gallery__error gallery__image"></div><div id="gallery__gif_play"></div><center id="gallery_video"><div id="gallery_video_wrap"></div></center></div><div class="gallery__footer" id="gallery_bottom"><table class="gallery__footer_table"><tr><td class="gallery__link"><a href="" id="g_advancepage"><span class="ico_gallery ico_gallery_mess m"></span> <span id="g_commentCnt" class="gallery__link_text"></span></a></td><td class="first gallery__link"><a href="" id="g_sharelink"><span class="ico ico_plus_white"></span> <span id="g_shareCnt" class="gallery__link_text"></span></a></td><td class="gallery__link"><a href="#glup" class="js-vote_btn" data-type="1" mode="gallery"><span class="ico_gallery ico_gallery_vote_up m"></span> <span class="js-vote_btn_cnt gallery__link_text"></span></a></td><td class="last gallery__link"><a href="#gldown" class="js-vote_btn" data-type="-1" mode="gallery"><span class="ico_gallery ico_gallery_vote_down m"></span> <span class="js-vote_btn_cnt gallery__link_text"></span></a></td></tr></table></div><img src="'+I+'" alt="" id="gallery_preload_0" class="hide" /><img src="'+I+'" alt="" id="gallery_preload_1" class="hide" /></div>';return a},adult:function(e){var l='<div class="gallery__error_inner"><div class="gallery__error-msg">'+L("Внимание! Эти материалы только для взрослых! ")+L("Нажимая &quot;Показать {0}&quot;, вы подтверждаете, ",e)+L("что вам 18 или более лет.")+'</div><div class="gallery_error-side prev"></div><div class="gallery_error-side next"></div><a href="#g-adult-show" class="gallery__button" id="gallery_adult_show"><span class="ico_gallery ico_gallery_eye m"></span> <span class="m">'+L("Показать  {0}",e)+"</span></a></div>";return l},notif:function(e){var l='<div id="gallery_notif"><table class="gallery__notif_inner"><tr><td>'+e.text+'</td><td style="width:18px"><a href="#gnc" class="js-gal_notif_close"><span class="ico_gallery ico_gallery_exit m"></span></a></td></tr></table></div>';return l},video:function(e){var l,a,t,r="";return e.exType==Spaces.ExternalVideo.YOUTUBE?(l=location.protocol+"//www.youtube.com/embed/"+e.exId+"?autoplay=&amp;origin="+location.protocol+"//"+base_domain(),r+='<div class="player-dummy_wrap"><iframe class="player-dummy" src="'+l+'" frameborder="0" style="width: 100%; height: 100%"></iframe></div>'):(a="",t={240:"avc1.42c00d, mp4a.40.2",360:"avc1.42c01e, mp4a.40.2",480:"avc1.4d401e, mp4a.40.2",720:"avc1.64001f, mp4a.40.2"},each(e.sources,function(e){e.res<=360&&e.converted&&(a+='<source src="'+e.link+'" type="video/mp4;codecs=&quot;'+t[e.res]+'&quot;" />')}),r+='<div class="player-dummy_wrap"><video preload="none" controls="controls" poster="'+e.preview+'" id="gallery_player" class="player-dummy">'+a+"</video></div>"),r},collectionsMotivator:function(e){var l='<div class="t_center">Сохраните этот файл в свою коллекцию. Нажмите кнопку <a href="'+e.link+'"><img class="m" alt="" src="'+ICONS_BASEURL+'ico/plus_white.png" /></a></div>';return l},onlyAuthMotivator:function(){var e='<div class="t_center"><div class="m">'+L("Извините, эта функция доступна только зарегистрированным пользователям.")+'</div><span class="m">'+L("Узнайте все преимущества")+'</span> <a href="/registration/" class="inl-link link-blue"><span class="m">'+L("регистрации")+'</span> <img src="'+ICONS_BASEURL+'ico/arr3_r_blue.png" alt="" class="m" /></a></div>';return e}},K={},P=[],G=!1,V=!1;Loader.ready(e),window.Gallery={onLike:o}});

Loader._(["cookie","sound","device","lite/core","lite/video","lite/music","lite/likes","lite/toolbar","lite/subscribe","lite/comments","lite/events","lite/touch","lite/gallery"]);